var Opmag_pwa_39 = function() {
    "use strict";
    var _lastYScroll = 0,
        _lastYScrollAnimation = 0,
        _scrollTick = !1,
        _postsUrls = [window.location.href],
        _postsUrlsRequested = {
            0: !0
        },
        _postsTitles = {
            0: document.getElementsByTagName("title")[0].innerHTML
        },
        _currentPostN = 0,
        _totalPosts = 0,
        _mode = null,
        _msgTkr = null,
        _passiveScrollIfSupported = !1;
    try {
        window.addEventListener("test", null, Object.defineProperty({}, "passive", {
            get: function() {
                _passiveScrollIfSupported = {
                    passive: !0
                }
            }
        }))
    } catch (err) {}
    var _checkCartoIframes = function() {
            $("amp-iframe").each(function() {
                var H, $this = $(this),
                    src = $this.attr("src"); - 1 === src.indexOf(".carto.com/") && -1 === src.indexOf("flo.uri.sh/") || (H = Math.min(.7 * $(window).height(), 520), $this.attr("height", H).css("height", H))
            })
        },
        _bindActionsArchive = function() {
            $("#numeric-posts-nav").hide(), window.addEventListener("scroll", function(e) {
                _lastYScroll = window.scrollY, _scrollTick || (window.requestAnimationFrame(function() {
                    _onArchiveScroll(_lastYScrollAnimation = _lastYScroll), _scrollTick = !1
                }), _scrollTick = !0)
            }, _passiveScrollIfSupported)
        },
        _bindActionsSingle = function() {
            window.addEventListener("scroll", function(e) {
                _lastYScroll = window.scrollY, _scrollTick || (window.requestAnimationFrame(function() {
                    _onSingleScroll(_lastYScrollAnimation = _lastYScroll), _scrollTick = !1
                }), _scrollTick = !0)
            }, _passiveScrollIfSupported), $("#go-to-next").bind("click", _scrollToNextPost)
        },
        _bindActionsCharts = function() {
            $(".opmag-chart-action-data-btn").click(function() {
                $(this).parents(".opmag-chart-selector-panel").find("iframe")[0].contentWindow.postMessage({
                    type: "export2CSV"
                }, "*")
            })
        },
        _initActiveHeadToolbar = function() {
            var opts = {
                    offset: 50,
                    tolerance: 10,
                    classes: {
                        initial: "head",
                        pinned: "head--pin",
                        unpinned: "head--unpin",
                        top: "head--top",
                        notTop: "head--not-top",
                        bottom: "head--bottom",
                        notBottom: "head--not-bottom"
                    }
                },
                H1 = document.getElementById("site-nav");
            H1 && new Headroom(H1, opts).init();
            var H2 = document.getElementById("series-nav");
            H2 && new Headroom(H2, opts).init();
            var H3 = document.getElementById("pol18_nav");
            H3 && new Headroom(H3, opts).init();
            var H4 = document.getElementById("pages-nav");
            H4 && new Headroom(H4, opts).init()
        },
        _initAutoSelectReadonlyTextArea = function() {
            $("textarea[readonly='readonly']").click(function() {
                this.focus(), this.select()
            })
        },
        _initClickCheckbox = function() {
            $(".click-checkbox").click(function(event) {
                "checkbox" !== event.target.type && $(":checkbox", this).trigger("click")
            })
        },
        _getRelatedPosts = function() {
            for (var relatedPostsLinks = document.getElementsByClassName("post-related-link"), i = 0; i < relatedPostsLinks.length; i++) _postsUrls.push(relatedPostsLinks[i].href), _postsTitles[i + 1] = $(relatedPostsLinks[i]).text();
            _totalPosts = _postsUrls.length, 0
        },
        _getArchivePages = function() {
            var navigation = document.getElementById("numeric-posts-nav");
            if (navigation && navigation.dataset) {
                for (var currentPage = Number(navigation.dataset.currentPage), totalPages = Number(navigation.dataset.totalPages), parsedUrl = navigation.dataset.archiveUrl.split("?"), baseUrl = parsedUrl[0], queryString = parsedUrl[1] ? "?" + parsedUrl[1] : "", i = currentPage + 1; i <= totalPages; i++) _postsUrls.push(baseUrl + "page/" + i + "/" + queryString), _postsTitles[i + 1] = "";
                _totalPosts = _postsUrls.length, 0
            }
        },
        _getMinidossierChapters = function() {
            _postsUrls = [], _postsTitles = {};
            for (var relatedPostsLinks = $(".series-chapter a"), i = 0; i < relatedPostsLinks.length; i++) _postsUrls.push(relatedPostsLinks[i].href), _postsTitles[i] = $(relatedPostsLinks[i]).text();
            _totalPosts = _postsUrls.length, 0
        },
        _createContainersSingle = function() {
            $(".section").addClass("section-0");
            for (var i = 1; i < _postsUrls.length; i++) $("#infinite-scrolling-container").append('<div class="section-next section-' + i + '"><div class="loader">Caricamento...</div></div>')
        },
        _onArchiveScroll = function(scroll_pos) {
            var CS = document.body.currentSection,
                scrollProgress = Math.max(0, Math.min(1, CS.viewportRangeBottom)),
                pageToLoad = _currentPostN + 1;
            pageToLoad < _postsUrls.length && .5 < scrollProgress && !_postsUrlsRequested[pageToLoad] && _loadArchivePage(pageToLoad)
        },
        _onSingleScroll = function(scroll_pos) {
            var next, _prevLink, _nextLink, _siblings_nav, C, title, url, CS = document.body.currentSection,
                _currentChapter = Number($(".chapter-link-current").attr("data-chapter-number")) - 1,
                scrollProgress = Math.max(0, Math.min(1, CS.viewportRangeBottom));
            document.getElementById("scroll-progress").style.width = 100 * scrollProgress + "%", _currentPostN !== document.body.currentSectionN && (next = _currentPostN < document.body.currentSectionN, $(".section-" + _currentPostN + " .mobile-share").hide(), _currentPostN = document.body.currentSectionN, $(".section-" + _currentPostN + " .mobile-share").show(), "minidossier" === _mode && (next ? _currentChapter++ : _currentChapter--, _siblings_nav = (_prevLink = _postsUrls[_currentChapter - 1]) ? '<a href="' + _prevLink + '" class="badge">Precedente</a>&nbsp;' : '<span class="badge">Precedente</span>&nbsp;', _siblings_nav += (_nextLink = _postsUrls[_currentChapter + 1]) ? '<a href="' + _nextLink + '" class="badge">Successivo</a>' : '<span class="badge">Successivo</span>', $(".section-0 .current-chapter-number").text(_currentChapter + 1), $(".section-0 .chapter-link").removeClass("chapter-link-current").filter(".chapter-link-" + (_currentChapter + 1)).addClass("chapter-link-current"), $(".section-0 .series-siblings-nav").empty().append(_siblings_nav)), title = _postsTitles[C = _currentChapter || _currentPostN], url = _postsUrls[C], $("title").html(title), $('link[rel="canonical"]').attr("href", url), history.pushState(null, title, url));
            var postToLoad = _currentChapter ? _currentChapter + 1 : _currentPostN + 1;
            postToLoad < _postsUrls.length ? (.5 < scrollProgress && !_postsUrlsRequested[postToLoad] && _loadSinglePost(postToLoad), .75 < scrollProgress ? ($("#go-to-next-title").text(_postsTitles[String(postToLoad)]), $("#go-to-next").addClass("show"), _msgTkr && _msgTkr.freeze(), $("#msg-tkr").removeClass("show")) : ($("#go-to-next").removeClass("show"), _msgTkr && _msgTkr.unfreeze(), $("#msg-tkr").addClass("show"))) : ($("#go-to-next").removeClass("show"), _msgTkr && _msgTkr.unfreeze(), $("#msg-tkr").addClass("show"))
        },
        _loadArchivePage = function(pageToLoad) {
            var url = _postsUrls[pageToLoad];
            url += -1 !== url.indexOf("?") ? "&post_type_switch=false" : "?post_type_switch=false", $(".section-" + pageToLoad).addClass("section-next-loading"), $.get(url, function(data) {
                var responsiveGrid = !1,
                    gridStart = data.indexOf('<div id="grid" class="grid section clearfix" data-columns>'); - 1 === gridStart ? gridStart = data.indexOf('<div class="container fix-pad section">') : responsiveGrid = !0;
                var sectionFragment, _items, grid, gridEnd = data.indexOf('<span class="section-end"></span>'); - 1 !== gridStart && -1 !== gridEnd && (sectionFragment = data.substring(gridStart, gridEnd), _items = $(sectionFragment).find(".item"), responsiveGrid ? (grid = document.querySelector("#grid"), salvattore.appendElements(grid, _items)) : $(".section").append(_items), OPMAG_viewport.reset(), _onArchiveScroll(window.scrollY), _currentPostN = pageToLoad)
            }), _postsUrlsRequested[pageToLoad] = !0
        },
        _loadSinglePost = function(postToLoad) {
            var url = _postsUrls[postToLoad];
            $(".section-" + postToLoad).addClass("section-next-loading"), $.get(url, function(data) {
                var $data = $(data),
                    _section = ($data.filter("title").text(), $data.find(".section"));
                _section.find("amp-iframe").each(function() {
                    var H, $this = $(this),
                        src = $this.attr("src"),
                        newIframe = $('<iframe frameborder="0" width="100%"></iframe>').attr("src", src); - 1 === src.indexOf(".carto.com/") && -1 === src.indexOf("flo.uri.sh/") || (H = Math.min(.7 * $(window).height(), 520), newIframe.attr("height", H)), $this.replaceWith(newIframe)
                }), _section.find(".mobile-share").hide(), _section.find(".series-nav-container").remove(), _section.find("table").wrap('<div class="table-wrap"></div>'), $(".section-" + postToLoad).empty().removeClass("section-next-loading").addClass("section-next-loaded").append(_section), OPMAG_viewport.reset(), _onSingleScroll(window.scrollY)
            }), _postsUrlsRequested[postToLoad] = !0
        },
        _scrollToNextPost = function(event) {
            event.preventDefault(), event.stopPropagation(), _scrollToPost(_currentPostN + 1)
        },
        _scrollToPost = function(postN) {
            var Y = $(".section-" + postN).offset().top,
                post_series_nav = $("#series-nav");
            post_series_nav.length && (Y -= post_series_nav.height()), $("html, body").animate({
                scrollTop: Y
            }, 600)
        };
    return window.addEventListener("message", function(event) {
        if ("embed-size" === event.data.type && event.data.height) {
            for (var frames = document.getElementsByTagName("iframe"), i = 0; i < frames.length; i++)
                if (frames[i].contentWindow === event.source) {
                    $(frames[i]).height(event.data.height), $(frames[i]).parents("amp-iframe").children("i-amphtml-sizer").css({
                        paddingTop: event.data.height
                    });
                    break
                }
            OPMAG_viewport.reset()
        }
    }, !1), {
        init: function() {
            switch ($("body").hasClass("single-opmag_minidossier") ? _mode = "minidossier" : $("body").hasClass("single") ? _mode = "single" : $("body").hasClass("page") ? _mode = "page" : $("body").hasClass("archive") ? _mode = "archive" : $("body").hasClass("home") && (_mode = "home"), _mode) {
                case "single":
                    _initActiveHeadToolbar(), _getRelatedPosts(), _createContainersSingle(), _bindActionsSingle(), _bindActionsCharts(), OPMAG_viewport.init("section"), _onSingleScroll(window.scrollY);
                    break;
                case "archive":
                    _initActiveHeadToolbar(), _getArchivePages(), _bindActionsArchive(), OPMAG_viewport.init("section"), _onArchiveScroll(window.scrollY);
                    break;
                case "minidossier":
                    _initActiveHeadToolbar(), _getMinidossierChapters(), _createContainersSingle(), _bindActionsSingle(), OPMAG_viewport.init("section"), _onSingleScroll(window.scrollY);
                    break;
                case "page":
                    _initActiveHeadToolbar();
                    break;
                case "home":
                    _bindActionsCharts(), _initActiveHeadToolbar()
            }
            _initAutoSelectReadonlyTextArea(), _initClickCheckbox(), $("table").wrap('<div class="table-wrap"></div>'), _checkCartoIframes()
        }
    }
}();
"complete" === document.readyState ? Opmag_pwa_39.init() : window.addEventListener("load", Opmag_pwa_39.init, 0), window.addEventListener("message", function(event) {}, !1);